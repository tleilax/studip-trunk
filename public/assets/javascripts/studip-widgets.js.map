{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./resources/assets/javascripts/studip-widgets-tabbable.js","webpack:///./resources/assets/javascripts/studip-widgets.js","webpack:///./resources/assets/javascripts/studip-widgetsystem.js","webpack:///./resources/assets/javascripts/string-crc32.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","$","STUDIP","document","on","event","selector","this","attr","addClass","siblings","removeClass","end","setTimeout","scrollTop","history","pushState","preventDefault","ready","location","hash","click","jQuery","getAddableWidgetList","url","Deferred","dfd","length","resolve","then","response","content","container_id","data","containerId","widgetsystem","WidgetSystem","elements","one_width","Math","floor","grid","width","appendTo","each","widget_id","widgetId","title","html","contents","children","clone","helper","body","header","append","addDraggable","element","draggable","recreate","css","zIndex","revert","droppable","stop","remove","parent","offset","position","left","pageX","top","pageY","reject","promise","href","done","toggleClass","jqxhr","getResponseHeader","slideUp","target","closest","GRID_CLASSNAME","renderServerSide","item","api","POST","id","el","x","y","height","status","element_id","find","replaceWith","container_element","gridstack","acceptWidgets","cellHeight","handle","resizable","autoHide","hashcode","JSON","stringify","serialize","crc32","store","bind","items","batchUpdate","forEach","trigger","commit","enableResize","dfd0","isDefaultPrevented","question","confirm","Dialog","action","path","push","callback","payload","timeout","command","hasContent","wrapper","result","decodeURIComponent","extractCallback","match","parseJSON","responseText","e","console","log","off","one","clearTimeout","always","type","getElement","PUT","before","async","nodes","node","sort","a","b","addElement","options","hide","packery","initializeWidgets","refresh","refreshElementLookup","show","removeElement","removeWidget","lockElement","state","undefined","locked","movable","removeAttr","setRemovableElement","cache","initialize","String","crcTable","k","makeCRCTable","crc","charCodeAt"],"mappings":"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","file":"javascripts/studip-widgets.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 53);\n","/*jslint browser: true */\n/*global jQuery, STUDIP */\n(function ($, STUDIP) {\n    'use strict';\n\n    $(document).on('click', '.tabbable-widget > nav > a', function (event) {\n        var selector = $(this).attr('href');\n        $(this).addClass('active').siblings().removeClass('active');\n        $(selector).addClass('active')\n                   .siblings('section').removeClass('active')\n                   .end();\n\n        // Delay resetting of scroll top until browser is no longer busy\n        // (otherwise the scrolled element will not reset - at least in FF)\n        setTimeout(function () {\n            $(selector).scrollTop(0);\n        }, 0);\n\n        if (history.pushState) {\n            history.pushState(null, null, selector);\n        }\n\n        event.preventDefault();\n    }).ready(function () {\n        if (!location.hash) {\n            return;\n        }\n\n        $('.tabbable-widget > nav > a[href=\"' + location.hash + '\"]').click();\n    });\n}(jQuery, STUDIP));\n","/*jslint browser: true, unparam: true */\n/*global jQuery, STUDIP */\n(function ($, STUDIP) {\n    'use strict';\n\n    function addDraggable(element, draggable, width) {\n        var helper   = draggable.clone(),\n            recreate = false;\n        element.append(helper.width(width));\n\n        helper.draggable({\n            appendTo: 'body',\n            helper: function () {\n                return $(this).clone().css({\n                    zIndex: 1000\n                });\n            },\n            revert: function (droppable) {\n                if (droppable !== false) {\n                    addDraggable(element, draggable, width);\n                    $('#layout-sidebar').removeClass('second-display');\n                    return false;\n                }\n\n                recreate = true;\n                return true;\n            },\n            stop: function () {\n                // Recreate draggable after revert. This is neccessary since\n                // gridstack occassionally fails with \"origNode._grid is\n                // undefined\". This will prevent that.\n                if (recreate) {\n                    helper.draggable('destroy').remove();\n                    addDraggable(element, draggable, width);\n                }\n            }\n        });\n    }\n\n    function getAddableWidgetList(url) {\n        return $.Deferred(function (dfd) {\n            if ($('#layout-sidebar .sidebar-secondary-widget').length > 0) {\n                return dfd.resolve();\n            }\n\n            $.get(url).then(function (response) {\n                var content      = $(response),\n                    container_id = $('.addable-widgets', content).data().containerId,\n                    widgetsystem = STUDIP.WidgetSystem.get(container_id),\n                    elements     = $('.addable-widgets div[data-widget-id]', content),\n                    one_width    = Math.floor($(widgetsystem.grid).width() / widgetsystem.width);\n\n                $(content).appendTo('#layout-sidebar > .sidebar');\n\n                $(elements).each(function () {\n                    var widget_id = $(this).data().widgetId,\n                        title     = $('h2', this).html(),\n                        contents  = $(this).children(':not(h2)').clone(),\n                        helper    = $('<div class=\"grid-stack-item widget-to-add\" data-gs-width=\"1\" data-gs-height=\"1\">').attr('data-widget-id', widget_id),\n                        body      = $('<div class=\"grid-stack-item-content has-layout\">').appendTo(helper),\n                        header    = $('<header class=\"widget-header\">').appendTo(body);\n\n                    $('<h2 class=\"widget-title\">').html(title).appendTo(header);\n                    $('<article class=\"widget-content\">').append(contents).appendTo(body);\n\n                    addDraggable($(this).parent(), helper, one_width);\n                });\n\n                // This will position the addable widget under the mouse cursor\n                // so that the whole li containing the widget may be used to\n                // drag the element to the grid. Otherwise there's a gap to the\n                // right.\n                $('#layout-sidebar .addable-widgets li').on('mousemove', function (event) {\n                    var offset = $(this).offset(),\n                        position = {\n                            left: event.pageX - offset.left - 16,\n                            top: event.pageY - offset.top - 16\n                        };\n\n                    $('.widget-to-add', this).css(position);\n                });\n\n                dfd.resolve();\n            }, dfd.reject);\n        }).promise();\n    }\n\n    $(document).ready(function () {\n        $('#layout-sidebar').on('click', '.widget-add-toggle', function () {\n            getAddableWidgetList(this.href).done(function () {\n                $('#layout-sidebar').toggleClass('second-display');\n            });\n\n            return false;\n        });\n    }).on('widget-add', function (event, jqxhr) {\n        var remove    = jqxhr.getResponseHeader('X-Widget-Remove'),\n            widget_id = jqxhr.getResponseHeader('X-Widget-Id');\n        if (remove) {\n            $('.addable-widgets li:has([data-widget-id=\"' + widget_id + '\"])').each(function () {\n                $('.ui-draggable', this).draggable('destroy');\n                $(this).slideUp(function () {\n                    $(this).remove();\n                });\n            });\n        }\n    }).on('widget-remove', function (event, jqxhr) {\n        if (jqxhr.getResponseHeader('X-Refresh')) {\n            $('#layout-sidebar .sidebar-secondary-widget').remove();\n        }\n    }).on('click', function (event) {\n        if ($(event.target).closest('.sidebar-secondary-widget').length === 0) {\n            $('#layout-sidebar').removeClass('second-display');\n        }\n    });\n\n}(jQuery, STUDIP));\n","/*jslint browser: true, unparam: true, todo: true */\n/*global jQuery, STUDIP */\n(function ($, STUDIP) {\n    'use strict';\n\n    var GRID_CLASSNAME = 'studip-widget-grid';\n\n    var renderServerSide = function (grid, item) {\n        return STUDIP.api.POST(\n            ['widgets', grid.id, item.el.data().widgetId],\n            {\n                data: {\n                    x: item.x,\n                    y: item.y,\n                    width: item.width,\n                    height: item.height\n                }\n            }\n        ).then(function (response, status, jqxhr) {\n            var element_id = jqxhr.getResponseHeader('X-Widget-Element-Id');\n            item.el\n                .attr('data-element-id', element_id)\n                .find('.grid-stack-item-content')\n                .replaceWith(response);\n            return jqxhr\n        });\n    };\n\n    // Create widget system class\n    function WidgetSystem(id, container_element) {\n        this.id    = id;\n\n        // Initialize grid\n        this.grid = $(container_element).addClass(GRID_CLASSNAME).gridstack({\n            acceptWidgets: '.widget-to-add',\n            width: 6, // TODO: Same as Widgets\\Container model\n            cellHeight: 'auto',\n            handle: '.widget-header',\n            resizable: {autoHide: false}\n        });\n\n        this.gridstack = this.grid.data('gridstack');\n\n        this.hashcode = JSON.stringify(this.serialize()).crc32();\n\n        // Store new layout after widget was dragged\n        this.grid.on('change', function () {\n            this.store();\n        }.bind(this)).on('added', function (event, items) {\n            // Disable updating of items\n            this.gridstack.batchUpdate();\n\n            items.forEach(function (item) {\n                renderServerSide(this, item)\n                    .done(function (response, status, jqxhr) {\n                        $(document).trigger('widget-add', [jqxhr]);\n                    })\n            }.bind(this))\n\n            // Update items (resizables as well)\n            this.gridstack.commit();\n            this.gridstack.enableResize(true, true);\n        }.bind(this)).on('click', '.widget-action:not([href])', function (event) {\n            // This is quite nasty. Since we use delegates on a specific element\n            // and not document, the default confirm handler will not be invoked\n            // until after this handler has finished. Thus, we will need to replicate\n            // the behaviour of the original data-confirm handler.\n            $.Deferred(function (dfd0) {\n                if (event.isDefaultPrevented()) {\n                    dfd0.reject();\n                } else if (!$(event.target).attr('data-confirm')) {\n                    dfd0.resolve();\n                } else {\n                    var question = $(event.target).data().confirm;\n                    STUDIP.Dialog.confirm(question).then(dfd0.resolve, dfd0.reject);\n                }\n            }).done(function () {\n                var action       = $(event.target).closest('[data-action]').data().action,\n                    element_id   = $(event.target).closest('.grid-stack-item').data('element-id'),\n                    container_id = this.id,\n                    path         = ['widgets', container_id, action, element_id];\n\n                if ($(event.target).data().hasOwnProperty('admin')) {\n                    path.push(1);\n                }\n\n                STUDIP.api.POST(path).then(function (response, status, jqxhr) {\n                    return $.Deferred(function (dfd) {\n                        var command    = jqxhr.getResponseHeader('X-Widget-Execute'),\n                            hasContent = status !== 'nocontent',\n                            wrapper    = $(event.target).closest('.grid-stack-item'),\n                            callback,\n                            payload,\n                            timeout,\n                            result = true;\n                        if (command) {\n                            command  = decodeURIComponent(command);\n                            callback = STUDIP.extractCallback(command);\n\n                            if (jqxhr.getResponseHeader('Content-Type').match(/json/) && hasContent) {\n                                try {\n                                    payload = $.parseJSON(jqxhr.responseText);\n                                } catch (e) {\n                                    console.log('error parsing json response', jqxhr.responseText);\n                                    payload = null;\n                                }\n                            } else {\n                                payload = jqxhr.responseText;\n                            }\n\n                            // TODO: This will try to detect whether the callback triggers\n                            //       any css transitions. If so, the layout will be repacked\n                            //       when the transition has ended. Otherwise it is repacked\n                            //       after a short delay\n                            timeout = setTimeout(function () {\n                                wrapper.off('transitionrun transitionend');\n                                dfd.resolve(response, status, jqxhr);\n                            }, 100);\n\n                            wrapper.one('transitionrun', function () {\n                                clearTimeout(timeout);\n                                wrapper.one('transitionend', function () {\n                                    dfd.resolve(response, status, jqxhr);\n                                });\n                            });\n\n                            result = callback(payload);\n                        }\n                        if (result !== false && hasContent) {\n                            $('.widget-content', wrapper).html(response);\n                            dfd.resolve(response, status, jqxhr);\n                        }\n                    }).promise();\n                }.bind(this)).done(function (response, status, jqxhr) {\n                    $(document).trigger('widget-' + action, [jqxhr]);\n                });\n            }.bind(this)).always(function () {\n                event.preventDefault();\n            });\n\n        }.bind(this)).on('resizestart resizestop', function (event) {\n            $(this).toggleClass('resizing', event.type === 'resizestart');\n        });\n    }\n\n    WidgetSystem.prototype.getElement = function (element_id) {\n        var element = this.grid.find('[data-element-id=\"' + element_id + '\"]');\n        if (element.length === 0) {\n            throw 'Unknown element with id ' + element_id;\n        }\n\n        return element;\n    };\n\n    WidgetSystem.prototype.store = function () {\n        STUDIP.api.PUT(['widgets', this.id], {\n            before: function () {\n                var elements = this.serialize(),\n                    hashcode = JSON.stringify(elements).crc32(),\n                    result   = hashcode !== this.hashcode;\n                this.hashcode = hashcode;\n                return result;\n            }.bind(this),\n            data: function () {\n                return {elements: this.serialize()};\n            }.bind(this),\n            async: true\n        });\n    };\n\n    WidgetSystem.prototype.serialize = function () {\n        var result = [];\n        this.gridstack.grid.nodes.forEach(function (node) {\n            result.push({\n                id: $(node.el).data('element-id'),\n                x: node.x,\n                y: node.y,\n                width: node.width,\n                height: node.height\n            });\n        });\n\n        return result.sort(function (a, b) {\n            return a.y - b.y\n                || a.x - b.x;\n        });\n    };\n\n    WidgetSystem.prototype.addElement = function (html, options) {\n        var element = $(html).hide();\n        this.grid.append(element);\n        this.grid.packery('appended', element).packery();\n        this.initializeWidgets(element);\n\n        options = options || {};\n\n        if (!options.hasOwnProperty('refresh') || options.refresh) {\n            this.refreshElementLookup();\n        }\n\n        element.show();\n\n        if (options.hasOwnProperty('position')) {\n            this.grid.packery('fit', element[0], options.position.left, options.position.top);\n        }\n\n        return this;\n    };\n\n    WidgetSystem.prototype.removeElement = function (element_id) {\n        var element = this.getElement(element_id);\n        this.gridstack.removeWidget(element);\n    };\n\n    WidgetSystem.prototype.lockElement = function (element_id, state) {\n        if (state === undefined) {\n            state = true;\n        }\n\n        var element = this.getElement(element_id);\n        this.gridstack.locked(element, state);\n        this.gridstack.movable(element, !state);\n        this.gridstack.resizable(element, !state);\n\n        if (state) {\n            $(element).closest('.grid-stack-item').attr('data-gs-locked', '');\n        } else {\n            $(element).closest('.grid-stack-item').removeAttr('data-gs-locked');\n        }\n    };\n\n    WidgetSystem.prototype.setRemovableElement = function (element_id, state) {\n        if (state === undefined) {\n            state = true;\n        }\n\n        var element = this.getElement(element_id);\n\n        if (state) {\n            $(element).closest('.grid-stack-item').attr('data-gs-removable', '');\n        } else {\n            $(element).closest('.grid-stack-item').removeAttr('data-gs-removable');\n        }\n    };\n\n    // Create widget system object\n    STUDIP.WidgetSystem = {\n        cache: {}\n    };\n\n    STUDIP.WidgetSystem.initialize = function (selector) {\n        var element = $(selector),\n            data    = element.data().widgetsystem;\n\n        if (!this.cache.hasOwnProperty(data.id)) {\n            this.cache[data.id] = new WidgetSystem(data.id, selector);\n        }\n\n        return this.cache[data.id];\n    };\n\n    STUDIP.WidgetSystem.get = function (id) {\n        if (!this.cache.hasOwnProperty(id)) {\n            throw 'Widgetsystem with id ' + id + ' has not been initialized yet';\n        }\n        return this.cache[id];\n    };\n\n    // Initialize widget system itself and possible instances on page\n    // TODO: REACTIVATE\n    // $(document).ready(function () {\n    //     $('.grid-stack').each(function () {\n    //         STUDIP.WidgetSystem.initialize(this);\n    //     });\n    // });\n\n}(jQuery, STUDIP));\n","/*jslint browser: true, bitwise: true */\n(function (String) {\n    'use strict';\n\n    function makeCRCTable() {\n        var c,\n            crcTable = [],\n            n,\n            k;\n        for (n = 0; n < 256; n += 1) {\n            c = n;\n            for (k = 0; k < 8; k += 1) {\n                c = ((c & 1) ? (0xEDB88320 ^ (c >>> 1)) : (c >>> 1));\n            }\n            crcTable[n] = c;\n        }\n        return crcTable;\n    }\n\n    var crcTable = makeCRCTable();\n\n    String.prototype.crc32 = function () {\n        var crc = 0 ^ (-1),\n            i;\n\n        for (i = 0; i < this.length; i += 1) {\n            crc = (crc >>> 8) ^ crcTable[(crc ^ this.charCodeAt(i)) & 0xFF];\n        }\n\n        return (crc ^ (-1)) >>> 0;\n    };\n\n}(String));\n"],"sourceRoot":""}