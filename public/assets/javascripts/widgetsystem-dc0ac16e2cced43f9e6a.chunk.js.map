{"version":3,"sources":["webpack:///./resources/assets/javascripts/chunks/widgetsystem.js"],"names":["__webpack_require__","r","__webpack_exports__","_lib_widget_system_js__WEBPACK_IMPORTED_MODULE_4__","getAddableWidgetList","url","$","Deferred","dfd","length","resolve","get","then","response","content","container_id","data","containerId","widgetsystem","STUDIP","WidgetSystem","elements","one_width","Math","floor","grid","width","appendTo","each","widget_id","this","widgetId","title","html","contents","children","clone","helper","body","header","attr","append","addDraggable","element","draggable","recreate","css","zIndex","revert","droppable","removeClass","stop","remove","parent","on","event","offset","position","left","pageX","top","pageY","reject","promise","document","jqxhr","getResponseHeader","_this","slideUp","target","closest","href","done","toggleClass"],"mappings":"mHAAAA,EAAAC,EAAAC,GAAAF,EAAA,QAAAA,EAAA,QAAAA,EAAA,QAAAA,EAAA,YAAAG,EAAAH,EAAA,QA2CA,SAASI,EAAqBC,GAC1B,OAAOC,EAAEC,SAAS,SAASC,GACvB,GAA4D,EAAxDF,EAAE,6CAA6CG,OAC/C,OAAOD,EAAIE,UAGfJ,EAAEK,IAAIN,GAAKO,KAAK,SAASC,GACrB,IAAIC,EAAUR,EAAEO,GACZE,EAAeT,EAAE,mBAAoBQ,GAASE,OAAOC,YACrDC,EAAeC,OAAOC,aAAaT,IAAII,GACvCM,EAAWf,EAAE,uCAAwCQ,GACrDQ,EAAYC,KAAKC,MAAMlB,EAAEY,EAAaO,MAAMC,QAAUR,EAAaQ,OAEvEpB,EAAEQ,GAASa,SAAS,8BAEpBrB,EAAEe,GAAUO,KAAK,WACb,IAAIC,EAAYvB,EAAEwB,MAAMd,OAAOe,SAC3BC,EAAQ1B,EAAE,KAAMwB,MAAMG,OACtBC,EAAW5B,EAAEwB,MAAMK,SAAS,YAAYC,QACxCC,EAAS/B,EAAE,oFACXgC,EAAOhC,EAAE,oDAAoDqB,SAASU,GACtEE,EAASjC,EAAE,kCAAkCqB,SAASW,GAE1DD,EAAOG,KAAK,iBAAkBX,GAE9BvB,EAAE,6BAA6B2B,KAAKD,GAAOL,SAASY,GACpDjC,EAAE,oCAAoCmC,OAAOP,GAAUP,SAASW,GA5DhF,SAASI,EAAaC,EAASC,EAAWlB,GACtC,IAAIW,EAASO,EAAUR,QACnBS,GAAW,EACfF,EAAQF,OAAOJ,EAAOX,MAAMA,IAE5BW,EAAOO,UAAU,CACbjB,SAAU,OACVU,OAAQ,WACJ,OAAO/B,EAAEwB,MAAMM,QAAQU,IAAI,CACvBC,OAAQ,OAGhBC,OAAQ,SAASC,GACb,OAAkB,IAAdA,GACAP,EAAaC,EAASC,EAAWlB,GACjCpB,EAAE,mBAAmB4C,YAAY,mBAC1B,GAGXL,GAAW,GAGfM,KAAM,WAIEN,IACAR,EAAOO,UAAU,WAAWQ,SAC5BV,EAAaC,EAASC,EAAWlB,OAkCjCgB,CAAapC,EAAEwB,MAAMuB,SAAUhB,EAAQf,KAO3ChB,EAAE,uCAAuCgD,GAAG,YAAa,SAASC,GAC9D,IAAIC,EAASlD,EAAEwB,MAAM0B,SACjBC,EAAW,CACXC,KAAMH,EAAMI,MAAQH,EAAOE,KAAO,GAClCE,IAAKL,EAAMM,MAAQL,EAAOI,IAAM,IAGpCtD,EAAE,iBAAkBwB,MAAMgB,IAAIW,KAGlCjD,EAAIE,WACLF,EAAIsD,UACRC,UAGPzD,EAAE0D,UAAUV,GAAG,aAAc,SAACC,EAAOU,GACjC,IAAIb,EAASa,EAAMC,kBAAkB,mBACjCrC,EAAYoC,EAAMC,kBAAkB,eACpCd,GACA9C,EAAE,4CAA8CuB,EAAY,OAAOD,KAAK,WAAW,IAAAuC,EAAArC,KAC/ExB,EAAE,gBAAiBwB,MAAMc,UAAU,WACnCtC,EAAEwB,MAAMsC,QAAQ,kBAAM9D,EAAE6D,GAAMf,eAGvCE,GAAG,gBAAiB,SAACC,EAAOU,GACvBA,EAAMC,kBAAkB,cACxB5D,EAAE,6CAA6C8C,WAEpDE,GAAG,QAAS,SAACC,GACwD,IAAhEjD,EAAEiD,EAAMc,QAAQC,QAAQ,6BAA6B7D,QACrDH,EAAE,mBAAmB4C,YAAY,oBAIzC5C,EAAE,mBAAmBgD,GAAG,QAAS,qBAAsB,WAKnD,OAJAlD,EAAqB0B,KAAKyC,MAAMC,KAAK,WACjClE,EAAE,mBAAmBmE,YAAY,qBAG9B,IAGXtD,OAAOC,aAAeA","file":"javascripts/widgetsystem-dc0ac16e2cced43f9e6a.chunk.js","sourcesContent":["/*jslint esversion: 6*/\nimport \"gridstack/dist/gridstack.css\"\nimport \"../../stylesheets/widgets.less\"\n\nimport 'gridstack';\nimport 'gridstack/dist/gridstack.jQueryUI.js';\n\nimport WidgetSystem from '../lib/widget_system.js';\n\nfunction addDraggable(element, draggable, width) {\n    var helper = draggable.clone();\n    var recreate = false;\n    element.append(helper.width(width));\n\n    helper.draggable({\n        appendTo: 'body',\n        helper: function() {\n            return $(this).clone().css({\n                zIndex: 1000\n            });\n        },\n        revert: function(droppable) {\n            if (droppable !== false) {\n                addDraggable(element, draggable, width);\n                $('#layout-sidebar').removeClass('second-display');\n                return false;\n            }\n\n            recreate = true;\n            return true;\n        },\n        stop: function() {\n            // Recreate draggable after revert. This is neccessary since\n            // gridstack occassionally fails with \"origNode._grid is\n            // undefined\". This will prevent that.\n            if (recreate) {\n                helper.draggable('destroy').remove();\n                addDraggable(element, draggable, width);\n            }\n        }\n    });\n}\n\nfunction getAddableWidgetList(url) {\n    return $.Deferred(function(dfd) {\n        if ($('#layout-sidebar .sidebar-secondary-widget').length > 0) {\n            return dfd.resolve();\n        }\n\n        $.get(url).then(function(response) {\n            var content = $(response);\n            var container_id = $('.addable-widgets', content).data().containerId;\n            var widgetsystem = STUDIP.WidgetSystem.get(container_id);\n            var elements = $('.addable-widgets div[data-widget-id]', content);\n            var one_width = Math.floor($(widgetsystem.grid).width() / widgetsystem.width);\n\n            $(content).appendTo('#layout-sidebar > .sidebar');\n\n            $(elements).each(function() {\n                var widget_id = $(this).data().widgetId;\n                var title = $('h2', this).html();\n                var contents = $(this).children(':not(h2)').clone();\n                var helper = $('<div class=\"grid-stack-item widget-to-add\" data-gs-width=\"1\" data-gs-height=\"1\">');\n                var body = $('<div class=\"grid-stack-item-content has-layout\">').appendTo(helper);\n                var header = $('<header class=\"widget-header\">').appendTo(body);\n\n                helper.attr('data-widget-id', widget_id);\n\n                $('<h2 class=\"widget-title\">').html(title).appendTo(header);\n                $('<article class=\"widget-content\">').append(contents).appendTo(body);\n\n                addDraggable($(this).parent(), helper, one_width);\n            });\n\n            // This will position the addable widget under the mouse cursor\n            // so that the whole li containing the widget may be used to\n            // drag the element to the grid. Otherwise there's a gap to the\n            // right.\n            $('#layout-sidebar .addable-widgets li').on('mousemove', function(event) {\n                var offset = $(this).offset();\n                var position = {\n                    left: event.pageX - offset.left - 16,\n                    top: event.pageY - offset.top - 16\n                };\n\n                $('.widget-to-add', this).css(position);\n            });\n\n            dfd.resolve();\n        }, dfd.reject);\n    }).promise();\n}\n\n$(document).on('widget-add', (event, jqxhr) => {\n    var remove = jqxhr.getResponseHeader('X-Widget-Remove');\n    var widget_id = jqxhr.getResponseHeader('X-Widget-Id');\n    if (remove) {\n        $('.addable-widgets li:has([data-widget-id=\"' + widget_id + '\"])').each(function() {\n            $('.ui-draggable', this).draggable('destroy');\n            $(this).slideUp(() => $(this).remove());\n        });\n    }\n}).on('widget-remove', (event, jqxhr) => {\n    if (jqxhr.getResponseHeader('X-Refresh')) {\n        $('#layout-sidebar .sidebar-secondary-widget').remove();\n    }\n}).on('click', (event) => {\n    if ($(event.target).closest('.sidebar-secondary-widget').length === 0) {\n        $('#layout-sidebar').removeClass('second-display');\n    }\n});\n\n$('#layout-sidebar').on('click', '.widget-add-toggle', function() {\n    getAddableWidgetList(this.href).done(function() {\n        $('#layout-sidebar').toggleClass('second-display');\n    });\n\n    return false;\n});\n\nSTUDIP.WidgetSystem = WidgetSystem;\n"],"sourceRoot":""}