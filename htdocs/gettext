#!/bin/bash

#
#  extract all Stud.IP message strings and merge with old translations
#

for language in en;
do {
	# first handle files separate
	mv locale/$language/LC_MESSAGES/studip_core.po locale/$language/LC_MESSAGES/studip_core.po.old
	xgettext -C -n --keyword=_ -o locale/$language/LC_MESSAGES/studip_core.pot  *.*
	msgmerge locale/$language/LC_MESSAGES/studip_core.po.old locale/$language/LC_MESSAGES/studip_core.pot --output-file=locale/$language/LC_MESSAGES/studip_core.po

	mv locale/$language/LC_MESSAGES/studip_resources.po locale/$language/LC_MESSAGES/studip_resources.po.old
	xgettext -C -n --keyword=_ -o locale/$language/LC_MESSAGES/studip_resources.pot  resources/*.* resources/lib/*.* resources/views/*.*
	msgmerge locale/$language/LC_MESSAGES/studip_resources.po.old locale/$language/LC_MESSAGES/studip_resources.pot --output-file=locale/$language/LC_MESSAGES/studip_resources.po

	mv locale/$language/LC_MESSAGES/studip_export.po locale/$language/LC_MESSAGES/studip_export.po.old
	xgettext -C -n --keyword=_ -o locale/$language/LC_MESSAGES/studip_export.pot  export/*.*
	msgmerge locale/$language/LC_MESSAGES/studip_export.po.old locale/$language/LC_MESSAGES/studip_export.pot --output-file=locale/$language/LC_MESSAGES/studip_export.po

	# then merge into one file
	msgcat locale/$language/LC_MESSAGES/studip_core.po locale/$language/LC_MESSAGES/studip.po --output-file=locale/$language/LC_MESSAGES/studip.po --use-first
	msgcat locale/$language/LC_MESSAGES/studip_resources.po locale/$language/LC_MESSAGES/studip.po --output-file=locale/$language/LC_MESSAGES/studip.po --use-first
	msgcat locale/$language/LC_MESSAGES/studip_export.po locale/$language/LC_MESSAGES/studip.po --output-file=locale/$language/LC_MESSAGES/studip.po --use-first
} ;
done
